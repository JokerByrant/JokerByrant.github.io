---
title: Java并发---学习笔记
date: 2020-08-25 11:51:57
tags: Java并发
categories: 后端技术
---

## 前言
关于 `Java` 并发，之前曾经也学习过一段时间，但是只理解了其中一些简单的概念，学习的很片面，现在就来系统的学习一下这方面的知识。

计算机技术经历了从 **单进程** 到 **多进程** 再到现在的 **多线程** 的发展历程，`Java` 并发的出现就是为了支持现代计算机在 **多线程** 环境下运行程序的特点。

### 多线程的优点和缺点
关于多线程优点和缺点的介绍可以看看这两篇文章：[多线程的优点](http://ifeve.com/benefits/)，[多线程的代价](http://ifeve.com/costs-of-multithreading/)。

其中在 [多线程的代价](http://ifeve.com/costs-of-multithreading/) 这篇中提到：
> 当CPU从执行一个线程切换到执行另外一个线程的时候，它需要先存储当前线程的本地的数据，程序指针等，然后载入另一个线程的本地数据，程序指针等，最后才开始执行。这种切换称为 **上下文切换** (`context switch`)。`CPU`会在一个上下文中执行一个线程，然后切换到另外一个上下文中执行另外一个线程。上下文切换并不廉价，如果没有必要，应该减少上下文切换的发生。

关于 **上下文切换** 的介绍可以参考这篇文章：[**上下文切换详解**](http://ifeve.com/context-switch-definition/)。这里我把对它的介绍贴出来：
> 上下文是指某一时间点 **`CPU` 寄存器** 和 **程序计数器** 的内容。**寄存器**是 `CPU` 内部的数量较少但是速度很快的内存（与之对应的是 `CPU` 外部相对较慢的 `RAM` 主内存）。**寄存器** 通过对常用值（通常是运算的中间值）的快速访问来提高计算机程序运行的速度。**程序计数器** 是一个专用的寄存器，用于表明指令序列中 `CPU` 正在执行的位置，**存的值为正在执行的指令的位置或者下一个将要被执行的指令的位置**，具体依赖于特定的系统。

### 并发编程模型
原文参考：[并发编程模型](http://ifeve.com/%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%9e%8b/)
> 并发系统可以采用多种并发编程模型来实现。并发模型指定了系统中的线程如何通过协作来完成分配给它们的作业。不同的并发模型采用不同的方式拆分作业，同时线程间的协作和交互方式也不相同。

#### 并行工作者模型
![并行工作者模型](https://ae01.alicdn.com/kf/U011338060bb94fe6a0ad232a7e07a9d0h.jpg)
上图就是并行工作者模型，使用这种模型，只需添加更多的工作者就可以提高系统的并行度。

这种模型有三个最明显的缺点：
1. 线程需要处理共享数据带来的 **竞态** 、 **死锁** 等并发性问题，以及在等待访问共享数据时线程的串行化问题。
2. 共享数据的在不同线程中的数据一致性问题
3. 线程的执行顺序是不确定的

上面提到的第一点 **共享数据带来的串行化问题** 有两种办法可以解决：
- 使用非阻塞并发算法
- 使用可持久化的数据结构

重点提一下 **可持久化的数据结构**，在 `Java` 中的 `CopyOnWriteArrayList` 就使用了这种结构，可以阅读一下这篇文章：[可持久化的数据结构](https://www.cnblogs.com/tedzhao/archive/2008/11/12/1332112.html)

#### 流水线并发模型
![](https://ae01.alicdn.com/kf/Ueaae6349d6ca4721ac036161ce3a83bcs.jpg)
> 类似于工厂中生产线上的工人们那样组织工作者。每个工作者只负责作业中的部分工作。当完成了自己的这部分工作时工作者会将作业转发给下一个工作者。每个工作者在自己的线程中运行，并且不会和其他工作者共享状态。有时也被成为 **无共享并行模型** 。
> 通常使用非阻塞的 `IO` 来设计使用流水线并发模型的系统。非阻塞的 `IO` 意味着工作者在开始一个 `IO` 操作后，`CPU` 不必在工作者进行 `IO` 操作时进入阻塞状态，而是可以进行其他操作，当 `IO` 操作完成时，再



## 参考链接
[Java全栈知识体系](https://www.pdai.tech/md/java/thread/java-thread-x-overview.html)
[并发编程网](http://ifeve.com/java-concurrency-thread-directory/)
